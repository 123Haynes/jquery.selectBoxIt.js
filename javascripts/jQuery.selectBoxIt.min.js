(function(b,p,w,l){var o=function(g,m,k){var a={originalElem:g,selectBox:b(g),selectItems:b(g).find("option"),firstSelectItem:b(g).find("option").slice(0,1),currentFocus:0,blur:!0,documentHeight:b(w).height(),textArray:[],currentIndex:0,currentText:"",options:m,divContainer:null,div:null,divText:null,list:null,listItems:null,downArrow:null,downArrowContainer:null,flipped:!1},o=function(){a.divText=b("<span/>",{id:a.originalElem.id+"SelectBoxItText",unselectable:"on",text:a.firstSelectItem.text()});
a.div=b("<div/>",{id:a.originalElem.id+"SelectBoxIt",name:a.originalElem.name,tabindex:0}).append(a.divText);a.divContainer=b("<div/>",{id:a.originalElem.id+"SelectBoxItContainer"}).append(a.div);return this},x=function(){var c="",h=b("<ul/>",{id:a.originalElem.id+"SelectBoxItOptions",tabindex:-1});a.options.showFirstOption||(a.selectItems=a.selectBox.find("option").slice(1));a.selectItems.each(function(h){c=c+('<li id="'+h+'">'+b(this).text()+"</li>");a.textArray[h]=b(this).text();if(this.selected){a.divText.text(b(this).text());
a.currentFocus=h}});h.append(c);a.list=h;a.divContainer.append(a.list);a.listItems=a.list.find("li");return this},y=function(){a.selectBox.css("display","none").after(a.divContainer);var c=a.div.height();a.downArrow=b("<span/>",{id:a.originalElem.id+"SelectBoxItArrow",unselectable:"on",style:"margin-top:"+c/2+";"});a.downArrowContainer=b("<span/>",{id:a.originalElem.id+"SelectBoxItArrowContainer",unselectable:"on",style:"height:"+c+"px;"}).append(a.downArrow);a.div.append(a.downArrowContainer);a.divText.css({"line-height":a.div.css("height"),
"max-width":a.div.width()-a.downArrowContainer.width()-5});return this},e=function(c){var b=a.list.scrollTop(),f=a.listItems.eq(a.currentFocus).height(),i=a.listItems.eq(a.currentFocus).position().top,d=a.list.height();"search"===c?d-i<f?a.list.scrollTop(b+(i-(d-f))):-1>i&&a.list.scrollTop(i-f):"up"===c?-1>i&&a.list.scrollTop(b-f):"down"===c&&d-i<f&&a.list.scrollTop(b+f);return this},z=function(){var c=a.div.offset().top,h=a.list.height(),f=a.div.height();c+f+h>=b(p).height()+b(p).scrollTop()&&0<=
c-h?a.flipped||(a.list.css("top",a.divContainer.position().top-a.list.height()-2),a.flipped=!0):a.flipped&&(a.list.css("top",a.divContainer.position().top+a.div.height()+2),a.flipped=!1)},d=function(c){b.isFunction(c)&&c.call(b(a.originalElem).data(k),a.div)},q=function(c){a.selectBox.trigger("open");z();switch(a.options.showEffect){case "none":a.list.show();e("search");break;case "show":a.list.show(a.options.showEffectSpeed,function(){e("search")});break;case "slideDown":a.list.slideDown(a.options.showEffectSpeed,
function(){e("search")});break;case "fadeIn":a.list.fadeIn(a.options.showEffectSpeed);e("search");break;default:a.list.is(":visible")||a.list.show(a.options.showEffect,a.options.showEffectOptions,a.options.showEffectSpeed,function(){e("search")})}d(c);return this},j=function(c){a.selectBox.trigger("close");switch(a.options.hideEffect){case "none":a.list.hide();e("search");break;case "hide":a.list.hide(a.options.hideEffectSpeed);break;case "slideUp":a.list.slideUp(a.options.hideEffectSpeed);break;
case "fadeOut":a.list.fadeOut(a.options.hideEffectSpeed);break;default:a.list.is(":visible")&&a.list.hide(a.options.hideEffect,a.options.hideEffectOptions,a.options.hideEffectSpeed,function(){e("search")})}d(c);return this},r=function(c){a.currentFocus+=1;a.currentFocus===a.listItems.length?a.currentFocus-=1:(a.listItems.eq(a.currentFocus-1).blur().end().eq(a.currentFocus).focus(),e("down"),a.selectBox.trigger("moveDown"));d(c);return this},s=function(c){a.currentFocus-=1;0>a.currentFocus||0===a.currentFocus&&
!a.options.showFirstOption?a.currentFocus+=1:(a.listItems.eq(a.currentFocus+1).blur().end().eq(a.currentFocus).focus(),e("up"),a.selectBox.trigger("moveUp"));d(c);return this},n=function(c){if(0!==c||a.options.showFirstOption)a.divText.text(a.textArray[c]),a.listItems.eq(a.currentFocus).blur(),a.currentIndex=c,a.currentFocus=c,a.listItems.eq(a.currentFocus).focus(),e("search");return this},t=function(c,b){var f=!1,d,e,g;d=c;for(g=a.textArray.length;d<g;d+=1){for(e=0;e<g;e+=1)-1!==a.textArray[e].search(b)&&
(f=!0,e=g);f||(a.currentText=a.currentText.charAt(a.currentText.length-1).replace(/[|()\[{.+*?$\\]/g,"\\$0"),b=RegExp(a.currentText,"gi"));if(2>a.currentText.length){if(-1!==a.textArray[d].charAt(0).search(b))return n(d),a.currentIndex+=1,a.selectBox.trigger("search"),!1}else if(-1!==a.textArray[d].search(b))return n(d),a.selectBox.trigger("search"),!1;if(a.textArray[d].toLowerCase()===a.currentText.toLowerCase())return n(d),a.currentText="",a.selectBox.trigger("search"),!1}return!0},u=function(c,
b,f){a.currentText=b?a.currentText+c.replace(/[|()\[{.+*?$\\]/g,"\\$0"):c.replace(/[|()\[{.+*?$\\]/g,"\\$0");c=RegExp(a.currentText,"gi");t(a.currentIndex,c)&&t(0,c);d(f);return this},A=function(){a.div.bind({"click.selectBoxIt":function(){a.originalElem.disabled||(a.selectBox.trigger("click"),a.list.is(":visible")?j():q())},"mousedown.selectBoxIt":function(){b(this).data("mdown",!0)},"blur.selectBoxIt":function(){a.blur&&(a.selectBox.trigger("blur").trigger("focusout"),a.list.is(":visible")&&j())},
"focus.selectBoxIt":function(c,d){var f=b(this).data("mdown");b(this).removeData("mdown");!d&&!f&&a.selectBox.trigger("tabFocus");d||a.selectBox.trigger("focus").trigger("focusin")},"keydown.selectBoxIt":function(c){var b=c.keyCode;if(a.div.is(":focus"))switch(b){case 40:c.preventDefault();a.options.keyboardNavigation&&r();break;case 38:c.preventDefault();a.options.keyboardNavigation&&s();break;case 13:c.preventDefault();a.list.is(":visible")&&j();!a.options.showFirstOption&&a.div.text()===a.firstSelectItem.text()&&
0===a.currentFocus&&a.selectBox.val(a.listItems.eq(a.currentFocus).text()).trigger("change");a.selectBox.trigger("enter");break;case 9:a.selectBox.trigger("tabBlur");break;case 8:c.preventDefault(),a.selectBox.trigger("backspace")}},"keypress.selectBoxIt":function(c){if(a.div.is(":focus")){var b=c.charCode||c.keyCode,d=String.fromCharCode(b);32===b&&c.preventDefault();a.options.keyboardSearch&&u(d,!0,"")}},"mouseenter.selectBoxIt":function(){a.selectBox.trigger("mouseenter")},"mouseleave.selectBoxIt":function(){a.selectBox.trigger("mouseleave")},
destroy:function(){b.removeData(a.selectBox[0],k)}});a.div.add(a.divText).add(a.downArrow).add(a.downArrowContainer).bind({"click.selectBoxIt":function(){a.div.is(":focus")||a.div.trigger("focus",!0)}});a.list.bind({"mouseover.selectBoxIt":function(){a.blur=!1},"mouseout.selectBoxIt":function(){a.blur=!0},"focusin.selectBoxIt":function(){a.div.trigger("focus",!0)}}).delegate("li","click.selectBoxIt",function(){a.originalElem.value=b(this).text();a.currentFocus=+this.id;j();a.originalElem.value!==
a.divText.text()&&a.selectBox.trigger("change")}).delegate("li","focus.selectBoxIt",function(){a.originalElem.value=b(this).text();a.selectBox.trigger("change")});a.selectBox.bind({"change.selectBoxIt":function(){a.divText.text(this.value)},"disable.selectBoxIt":function(){a.div.addClass("ui-state-disabled")},"enable.selectBoxIt":function(){a.div.removeClass("ui-state-disabled")}});return this},B=function(){a.div.attr({role:"combobox","aria-autocomplete":"list","aria-expanded":"false","aria-owns":a.list.attr("id"),
"aria-activedescendant":a.listItems.eq(a.currentFocus).attr("id"),"aria-label":b("label[for='"+a.originalElem.id+"']").text()||"","aria-live":"assertive"}).bind({"disable.selectBoxIt":function(){a.div.attr("aria-disabled","true")},"enable.selectBoxIt":function(){a.div.attr("aria-disabled","false")}});a.list.attr({role:"listbox","aria-hidden":"true"});a.listItems.attr({role:"option"});a.selectBox.bind({"change.selectBoxIt":function(){a.divText.attr("aria-label",a.originalElem.value)},"open.selectBoxIt":function(){a.list.attr("aria-hidden",
"false");a.div.attr("aria-expanded","true")},"close.selectBoxIt":function(){a.list.attr("aria-hidden","true");a.div.attr("aria-expanded","false")}});return this},v=function(c){j();a.selectBox.trigger("disable").attr("disabled","disabled");a.div.removeAttr("tabindex").css("cursor","default");d(c);return this},C=function(){a.originalElem.disabled&&v();return this},D=function(){a.div.addClass("ui-widget ui-state-default");a.list.addClass("ui-widget ui-widget-content");a.listItems.bind({"focus.selectBoxIt":function(){b(this).addClass("ui-state-focus")},
"blur.selectBoxIt":function(){b(this).removeClass("ui-state-focus")}});a.selectBox.bind({"open.selectBoxIt":function(){a.div.removeClass("ui-state-hover").add(a.listItems.eq(a.currentFocus)).addClass("ui-state-focus")},"blur.selectBoxIt":function(){a.div.removeClass("ui-state-focus")},"mouseenter.selectBoxIt":function(){a.div.addClass("ui-state-hover")},"mouseleave.selectBoxIt":function(){a.div.removeClass("ui-state-hover")}});a.listItems.bind({"mouseenter.selectBoxIt":function(){a.listItems.removeClass("ui-state-focus ui-state-hover");
b(this).addClass("ui-state-hover")},"mouseleave.selectBoxIt":function(){b(this).removeClass("ui-state-hover")}});a.downArrow.addClass("ui-icon ui-icon-triangle-1-s").css({"margin-top":a.downArrowContainer.height()/3});return this},E=function(a){return b.Deferred(function(b){setTimeout(b.resolve,a)})};return{version:"0.1.0",self:a,open:q,close:j,moveDown:r,moveUp:s,search:u,getOption:function(c,b){d(b);return a.options[c]||l},getOptions:function(c){d(c);return a.options||l},setOption:function(c,b,
e){a.options[c]!==l&&(a.options[c]=b);"showFirstOption"===c&&!b?a.listItems.eq(0).hide():"showFirstOption"===c&&b&&a.listItems.eq(0).show();d(e);return this},setOptions:function(c,e){b.isPlainObject(c)&&(a.options=b.extend({},a.options,c));a.options.showFirstOption?a.listItems.eq(0).show():a.listItems.eq(0).hide();d(e);return this},disable:v,enable:function(c){a.selectBox.trigger("enable").removeAttr("disabled");a.div.attr("tabindex",0).css("cursor","pointer");d(c);return this},destroy:function(c){a.div.unbind(".selectBoxIt").undelegate(".selectBoxIt");
a.div.trigger("destroy");a.divContainer.remove();a.selectBox.trigger("destroy").show();d(c);return this},wait:function(a,b){E(a).then(function(){d(b)});return this},create:function(c){b(g).is(":visible")&&(o(),x(),y(),A(),C(),B(),D(),a.selectBox.trigger("create"),d(c));return this}}};b.fn.selectBoxIt=function(g){return this.each(function(){var m=b(this),k;b.data(m[0],"selectBoxIt")||(g=b.extend({},b.fn.selectBoxIt.options,g),k=(new o(this,g,"selectBoxIt")).create(),b.data(m[0],"selectBoxIt",k),b.extend(b.expr[":"],
{selectBoxIt:function(a){return b(a).data("selectBoxIt")!==l}}))})};b.fn.selectBoxIt.options={showEffect:"none",showEffectOptions:{},showEffectSpeed:"medium",hideEffect:"none",hideEffectOptions:{},hideEffectSpeed:"medium",keyboardSearch:!0,keyboardNavigation:!0,showFirstOption:!0}})(jQuery,window,document);