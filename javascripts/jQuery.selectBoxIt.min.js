(function(b,q,v,k){var p=function(g,l,j){var a={originalElem:g,selectBox:b(g),selectItems:b(g).find("option"),firstSelectItem:b(g).find("option").slice(0,1),currentFocus:0,blur:!0,documentHeight:b(v).height(),textArray:[],currentIndex:0,currentText:"",options:l,divContainer:null,div:null,divText:null,list:null,listItems:null,downArrow:null,downArrowContainer:null,flipped:!1},p=function(){a.divText=b("<span/>",{id:a.originalElem.id+"SelectBoxItText",unselectable:"on",text:a.firstSelectItem.text()}).attr("data-val",
a.originalElem.value);a.div=b("<div/>",{id:a.originalElem.id+"SelectBoxIt",name:a.originalElem.name,unselectable:"on",tabindex:0}).append(a.divText);a.divContainer=b("<div/>",{id:a.originalElem.id+"SelectBoxItContainer"}).append(a.div);return this},w=function(){var c="",d=b("<ul/>",{id:a.originalElem.id+"SelectBoxItOptions",tabindex:-1});a.options.showFirstOption||(a.selectItems=a.selectBox.find("option").slice(1));a.selectItems.each(function(d){var h=b(this).prop("disabled");c=c+('<li id="'+d+'" data-val="'+
this.value+'" data-disabled="'+h+'">'+b(this).text()+"</li>");a.textArray[d]=b(this).text();if(this.selected){a.divText.text(b(this).text());a.currentFocus=d}a.options.defaultText&&a.divText.text(a.options.defaultText)});d.append(c);a.list=d;a.divContainer.append(a.list);a.listItems=a.list.find("li");a.list.find("li[data-disabled='true']").addClass("ui-state-disabled");0===a.currentFocus&&!a.options.showFirstOption&&a.listItems.eq(0).hasClass("ui-state-disabled")&&(a.currentFocus=+a.listItems.not(".ui-state-disabled").first().attr("id"));
return this},x=function(){a.selectBox.css("display","none").after(a.divContainer);var c=a.div.height();a.downArrow=b("<span/>",{id:a.originalElem.id+"SelectBoxItArrow",unselectable:"on",style:"margin-top:"+c/2+";"});a.downArrowContainer=b("<span/>",{id:a.originalElem.id+"SelectBoxItArrowContainer",unselectable:"on",style:"height:"+c+"px;"}).append(a.downArrow);a.div.append(a.downArrowContainer);a.divText.css({"line-height":a.div.css("height"),"max-width":a.div.width()-a.downArrowContainer.width()-
5});return this},f=function(c,d){var b=a.list.scrollTop(),h=a.listItems.eq(a.currentFocus).height(),e=a.listItems.eq(a.currentFocus).position().top,f=a.list.height();"search"===c?f-e<h?a.list.scrollTop(b+(e-(f-h))):-1>e&&a.list.scrollTop(e-h):"up"===c?-1>e&&a.list.scrollTop(b-h*d):"down"===c&&f-e<h&&a.list.scrollTop(b+h*d);return this},y=function(){var c=a.div.offset().top,d=a.list.height(),e=a.div.height();c+e+d>=b(q).height()+b(q).scrollTop()&&0<=c-d?a.flipped||(a.list.css("top",a.divContainer.position().top-
a.list.height()-2),a.flipped=!0):a.flipped&&(a.list.css("top",a.divContainer.position().top+a.div.height()+2),a.flipped=!1)},e=function(c){b.isFunction(c)&&c.call(b(a.originalElem).data(j),a.div)},r=function(c){a.selectBox.trigger("open");y();switch(a.options.showEffect){case "none":a.list.show();f("search");break;case "show":a.list.show(a.options.showEffectSpeed,function(){f("search")});break;case "slideDown":a.list.slideDown(a.options.showEffectSpeed,function(){f("search")});break;case "fadeIn":a.list.fadeIn(a.options.showEffectSpeed);
f("search");break;default:a.list.is(":visible")||a.list.show(a.options.showEffect,a.options.showEffectOptions,a.options.showEffectSpeed,function(){f("search")})}e(c);return this},i=function(c){a.selectBox.trigger("close");switch(a.options.hideEffect){case "none":a.list.hide();f("search");break;case "hide":a.list.hide(a.options.hideEffectSpeed);break;case "slideUp":a.list.slideUp(a.options.hideEffectSpeed);break;case "fadeOut":a.list.fadeOut(a.options.hideEffectSpeed);break;default:a.list.is(":visible")&&
a.list.hide(a.options.hideEffect,a.options.hideEffectOptions,a.options.hideEffectSpeed,function(){f("search")})}e(c);return this},m=function(c){a.currentFocus+=1;var d=1;if((d=a.listItems.eq(a.currentFocus).hasClass("ui-state-disabled"))&&a.currentFocus!==a.listItems.length-1)a.listItems.eq(a.currentFocus-1).blur(),m();else return a.currentFocus===a.listItems.length-1&&d?a.currentFocus=+a.listItems.eq(a.currentFocus).prevAll("li").not(".ui-state-disabled").attr("id"):a.currentFocus===a.listItems.length?
a.currentFocus-=1:(a.listItems.eq(a.currentFocus-1).blur().end().eq(a.currentFocus).focus(),d=+a.listItems.eq(a.currentFocus).prevAll("li.ui-state-disabled").attr("id"),d=a.currentFocus-d||1,f("down",d),a.selectBox.trigger("moveDown")),e(c),this},n=function(c){a.currentFocus-=1;var d=1;if((d=a.listItems.eq(a.currentFocus).hasClass("ui-state-disabled"))&&-1<a.currentFocus)a.listItems.eq(a.currentFocus+1).blur(),n();else return 0===a.currentFocus&&d?a.currentFocus=+a.listItems.eq(a.currentFocus).prevAll("li").not(".ui-state-disabled").attr("id"):
-1===a.currentFocus?a.currentFocus+=1:(a.listItems.eq(a.currentFocus+1).blur().end().eq(a.currentFocus).focus(),d=+a.listItems.eq(a.currentFocus).prevAll("li").not(".ui-state-disabled").attr("id"),d=a.currentFocus-d||1,f("up",d),a.selectBox.trigger("moveUp")),e(c),this},o=function(c){if((0!==c||a.options.showFirstOption)&&!a.listItems.eq(c).hasClass("ui-state-disabled"))a.divText.text(a.textArray[c]),a.listItems.eq(a.currentFocus).blur(),a.currentIndex=c,a.currentFocus=c,a.listItems.eq(a.currentFocus).focus(),
f("search"),a.selectBox.trigger("search");return this},s=function(c,d){var b=!1,e,f,g;e=c;for(g=a.textArray.length;e<g;e+=1){for(f=0;f<g;f+=1)-1!==a.textArray[f].search(d)&&(b=!0,f=g);b||(a.currentText=a.currentText.charAt(a.currentText.length-1).replace(/[|()\[{.+*?$\\]/g,"\\$0"),d=RegExp(a.currentText,"gi"));if(2>a.currentText.length){if(-1!==a.textArray[e].charAt(0).search(d))return o(e),a.currentIndex+=1,!1}else if(-1!==a.textArray[e].search(d))return o(e),!1;if(a.textArray[e].toLowerCase()===
a.currentText.toLowerCase())return o(e),a.currentText="",!1}return!0},t=function(c,d,b){a.currentText=d?a.currentText+c.replace(/[|()\[{.+*?$\\]/g,"\\$0"):c.replace(/[|()\[{.+*?$\\]/g,"\\$0");c=RegExp(a.currentText,"gi");s(a.currentIndex,c)&&s(0,c);e(b);return this},z=function(){a.div.bind({"click.selectBoxIt":function(){a.originalElem.disabled||(a.selectBox.trigger("click"),a.list.is(":visible")?i():r())},"mousedown.selectBoxIt":function(){b(this).data("mdown",!0)},"blur.selectBoxIt":function(){a.blur&&
(a.selectBox.trigger("blur").trigger("focusout"),a.list.is(":visible")&&i())},"focus.selectBoxIt":function(c,d){var e=b(this).data("mdown");b(this).removeData("mdown");!d&&!e&&a.selectBox.trigger("tabFocus");d||a.selectBox.trigger("focus").trigger("focusin")},"keydown.selectBoxIt":function(c){var b=c.keyCode;if(a.div.is(":focus"))switch(b){case 40:c.preventDefault();a.options.keyboardNavigation&&m();break;case 38:c.preventDefault();a.options.keyboardNavigation&&n();break;case 13:c.preventDefault();
a.list.is(":visible")&&i();(!a.options.showFirstOption&&a.div.text()===a.firstSelectItem.text()&&0===a.currentFocus||a.options.showFirstOption&&a.options.defaultText||!a.options.showFirstOption&&a.listItems.eq(0).hasClass("ui-state-disabled"))&&a.selectBox.val(a.listItems.eq(a.currentFocus).attr("data-val")).trigger("change");a.selectBox.trigger("enter");break;case 9:a.selectBox.trigger("tabBlur");break;case 8:c.preventDefault();a.selectBox.trigger("backspace");break;case 27:i()}},"keypress.selectBoxIt":function(c){if(a.div.is(":focus")){var b=
c.charCode||c.keyCode,e=String.fromCharCode(b);32===b&&c.preventDefault();a.options.keyboardSearch&&t(e,!0,"")}},"mouseenter.selectBoxIt":function(){a.selectBox.trigger("mouseenter")},"mouseleave.selectBoxIt":function(){a.selectBox.trigger("mouseleave")},destroy:function(){b.removeData(a.selectBox[0],j)}});a.div.add(a.divText).add(a.downArrow).add(a.downArrowContainer).bind({"click.selectBoxIt":function(){a.div.is(":focus")||a.div.trigger("focus",!0)}});a.list.bind({"mouseover.selectBoxIt":function(){a.blur=
!1},"mouseout.selectBoxIt":function(){a.blur=!0},"focusin.selectBoxIt":function(){a.div.trigger("focus",!0)}}).delegate("li","click.selectBoxIt",function(){b(this).hasClass("ui-state-disabled")||(a.originalElem.value=b(this).attr("data-val"),a.currentFocus=+this.id,i(),(a.originalElem.value!==a.divText.attr("data-val")||a.options.defaultText!==a.originalElem.value)&&a.selectBox.trigger("change"))}).delegate("li","focus.selectBoxIt",function(){b(this).hasClass("ui-state-disabled")||(a.originalElem.value=
b(this).attr("data-val"),a.selectBox.trigger("change"))});a.selectBox.bind({"change.selectBoxIt":function(){a.divText.text(a.listItems.eq(a.currentFocus).text()).attr("data-val",a.originalElem.value)},"disable.selectBoxIt":function(){a.div.addClass("ui-state-disabled")},"enable.selectBoxIt":function(){a.div.removeClass("ui-state-disabled")}});return this},A=function(){a.div.attr({role:"combobox","aria-autocomplete":"list","aria-expanded":"false","aria-owns":a.list.attr("id"),"aria-activedescendant":a.listItems.eq(a.currentFocus).attr("id"),
"aria-label":b("label[for='"+a.originalElem.id+"']").text()||"","aria-live":"assertive"}).bind({"disable.selectBoxIt":function(){a.div.attr("aria-disabled","true")},"enable.selectBoxIt":function(){a.div.attr("aria-disabled","false")}});a.list.attr({role:"listbox","aria-hidden":"true"});a.listItems.attr({role:"option"});a.selectBox.bind({"change.selectBoxIt":function(){a.divText.attr("aria-label",a.originalElem.value)},"open.selectBoxIt":function(){a.list.attr("aria-hidden","false");a.div.attr("aria-expanded",
"true")},"close.selectBoxIt":function(){a.list.attr("aria-hidden","true");a.div.attr("aria-expanded","false")}});return this},u=function(c){i();a.selectBox.trigger("disable").attr("disabled","disabled");a.div.removeAttr("tabindex").css("cursor","default");e(c);return this},B=function(){a.originalElem.disabled&&u();return this},C=function(){a.div.addClass("ui-widget ui-state-default");a.list.addClass("ui-widget ui-widget-content");a.listItems.bind({"focus.selectBoxIt":function(){b(this).addClass("ui-state-focus")},
"blur.selectBoxIt":function(){b(this).removeClass("ui-state-focus")}});a.selectBox.bind({"open.selectBoxIt":function(){a.div.removeClass("ui-state-hover").add(a.listItems.eq(a.currentFocus)).addClass("ui-state-focus")},"blur.selectBoxIt":function(){a.div.removeClass("ui-state-focus")},"mouseenter.selectBoxIt":function(){a.div.addClass("ui-state-hover")},"mouseleave.selectBoxIt":function(){a.div.removeClass("ui-state-hover")}});a.listItems.bind({"mouseenter.selectBoxIt":function(){a.listItems.removeClass("ui-state-focus ui-state-hover");
b(this).addClass("ui-state-hover")},"mouseleave.selectBoxIt":function(){b(this).removeClass("ui-state-hover")}});a.downArrow.addClass("ui-icon ui-icon-triangle-1-s").css({"margin-top":a.downArrowContainer.height()/3});return this},D=function(a){return b.Deferred(function(b){setTimeout(b.resolve,a)})};return{version:"0.1.0",self:a,open:r,close:i,moveDown:m,moveUp:n,search:t,getOption:function(c,b){e(b);return a.options[c]||k},getOptions:function(c){e(c);return a.options||k},setOption:function(c,b,
f){a.options[c]!==k&&(a.options[c]=b);"showFirstOption"===c&&!b?a.listItems.eq(0).hide():"showFirstOption"===c&&b?a.listItems.eq(0).show():"defaultText"===c&&a.divText.text(b);e(f);return this},setOptions:function(c,d){b.isPlainObject(c)&&(a.options=b.extend({},a.options,c));a.options.showFirstOption?a.listItems.eq(0).show():a.listItems.eq(0).hide();a.options.defaultText&&a.divText.text(a.options.defaultText);e(d);return this},disable:u,enable:function(c){a.selectBox.trigger("enable").removeAttr("disabled");
a.div.attr("tabindex",0).css("cursor","pointer");e(c);return this},destroy:function(c){a.div.unbind(".selectBoxIt").undelegate(".selectBoxIt");a.div.trigger("destroy");a.divContainer.remove();a.selectBox.trigger("destroy").show();e(c);return this},wait:function(a,b){D(a).then(function(){e(b)});return this},create:function(c){b(g).is(":visible")&&(p(),w(),x(),z(),B(),A(),C(),a.selectBox.trigger("create"),e(c));return this}}};b.fn.selectBoxIt=function(g){return this.each(function(){var l=b(this),j;
b.data(l[0],"selectBoxIt")||(g=b.extend({},b.fn.selectBoxIt.options,g),j=(new p(this,g,"selectBoxIt")).create(),b.data(l[0],"selectBoxIt",j),b.extend(b.expr[":"],{selectBoxIt:function(a){return b(a).data("selectBoxIt")!==k}}))})};b.fn.selectBoxIt.options={showEffect:"none",showEffectOptions:{},showEffectSpeed:"medium",hideEffect:"none",hideEffectOptions:{},hideEffectSpeed:"medium",keyboardSearch:!0,keyboardNavigation:!0,showFirstOption:!0,defaultText:null}})(jQuery,window,document);